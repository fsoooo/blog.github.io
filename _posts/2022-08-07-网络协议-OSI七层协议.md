信号的传输总要符合一定的**协议(protocol)**。

比如说长城上放狼烟，是因为人们已经预先设定好狼烟这个物理信号代表了“敌人入侵”这一抽象信号。

这样一个“狼烟=敌人入侵”就是一个简单的协议。

协议可以更复杂，比如摩尔斯码(Morse Code)，使用短信号和长信号的组合，来代表不同的英文字母。

比如SOS(***---***, * 代表短信号，-代表长信号)。这样* **= S, ---=O"就是摩尔斯码规定的协议。然而更进一层，人们会知道SOS是求助信息，原因是我们有“SOS=求救”这个协议存在在脑海里。**

所以**"***---***=SOS=求救"**是一个由两个协议组成的分层通信系统。

互联网的本质就是**一系列的网络协议**，这个协议就叫 **OSI协议（一系列协议）**，按照功能不同，分工不同，人为的分层七层。实际上这个七层是不存在的。没有这七层的概念，只是人为的划分而已。区分出来的目的只是让你明白哪一层是干什么用的。

每一层都运行不同的协议。协议是干什么的，协议就是标准。

实际上还有人把它划成五层、四层。

**七层**划分为：**应用层、表示层、会话层、传输层、网络层、数据链路层、物理层**。

**五层**划分为：**应用层、传输层、网络层、数据链路层、物理层**。

**四层**划分为：**应用层、传输层、网络层、网络接口层**。

![image](https://upload-images.jianshu.io/upload_images/6943526-f1a5a84ccfcd2af2?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240) 

**物理层（physical layer）：**

字面意思解释：物理传输、硬件、物理特性。所谓的物理层，是指光纤、电缆或者电磁波等真实存在的物理媒介。在深圳的你与北京的朋友聊天，你的电脑必须要能上网，物理体现是什么？是不是接一根网线，插个路由器，北京的朋友那边是不是也有根网线，也得插个路由器。也就是说计算机与计算机之间的通信，必须要有底层物理层方面的连通，就类似于你打电话，中间是不是必须得连电话线。

中间的物理链接可以是**光缆、电缆、双绞线、无线电波**。这些媒介可以传送物理信号，比如亮度、电压或者振幅。对于数字应用来说，我们只需要两种物理信号来分别表示0和1，比如用高电压表示1，低电压表示0，就构成了简单的物理层协议。针对某种媒介，电脑可以有相应的接口，用来接收物理信号，并解读成为0/1序列。中间传的是电信号，即010101...这些二进制位。

![image](https://upload-images.jianshu.io/upload_images/6943526-755d5858a8e070d7?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240) 

底层传输的010010101001...这些二级制位怎么才能让它有意义呢？

![image](https://upload-images.jianshu.io/upload_images/6943526-a6a399f59cccbf83?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240) 

要让这些010010101001...有意思，人为的分组再适合不过了，8位一组，发送及接收都按照8位一组来划分。接收到8位为一组的话，那么就可以按照这8位数来做运算。如果没有分组，对方接收的计算机根本就不知道从哪一位开始来做计算，也解析不了收到的数据。我发了16位你就按照16位来做计算吗？我发100位你就按照100位做计算吗？没什么意义是吧。因此要想让底层的电信号有意义，必须要把底层的电信号做分组。我做好8位一组，那么我收到数据，我就知道这几个8位做一组，这几个8位做一组。那么每个8位就可以得到一个确定的数。**分组是谁干的活呢？物理层干不了，这个是数据链路层干的。**

**数据链路层**

早期的时候，**数据链路层就是来对电信号来做分组的**。以前每个公司都有自己的分组方式，非常的乱，后来形成了统一的标准（标准就是协议），即以太网协议Ethernet。

Ethernet规定一组电信号称之为一个数据包，或者叫做一个**“帧”**。所谓的**“帧”** ，是一段有限的0/1序列。

连接层协议的功能就是识别0/1序列中所包含的帧。比如说，根据一定的0/1组合识别出帧的起始和结束。在帧中，有收信地址(Source, SRC)和送信地址(Destination, DST)，还有能够探测错误的校验序列(Frame Check Sequence)。当然，帧中最重要的最重要是所要传输的数据 (payload)。这些数据往往符合更高层协议，供网络的上层使用。与数据相配套，帧中也有数据的类型(Type)信息。连接层协议不关心数据中到底包含什么。帧就像是一个信封，把数据包裹起来。

*   每一数据帧分成：报头head和数据data两部分

![image](https://upload-images.jianshu.io/upload_images/6943526-98d0cc061e04fb92?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240) 

head包含：（固定18个字节）

*   发送者（源地址，6个字节）

*   接收者（目标地址，6个字节）

*   数据类型（6个字节）

data包含：（最短46字节，最长1500字节）

*   数据包的具体内容

head长度+data长度=最短64字节，最长1518字节，超过最大限制就分片发送。

这就像写信，发送者的地址（源地址）就是你家的地址，接收者地址（目标地址）就是对方的收信地址，你家的路由器就相当于邮局。其实在计算机通信中的源地址和目标地址指的是**mac地址**。

Mac地址的由来：

head中包含的源和目标地址由来：Ethernet规定接入Internet的设备都必须具备网卡，发送端的和接收端的地址便是指网卡的地址，即Mac地址。

每块网卡出厂时都被烧录上一个实际上唯一的Mac地址，长度为48位2进制，通常由12位16进制数表示，（前六位是厂商编码，后六位是流水线号）

![image](https://upload-images.jianshu.io/upload_images/6943526-7f277c14096539a0?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240) 

有了mac地址以后，计算机就可以通信了，假设一个教室就是一个局域网（隔离的网络），这个教室里面有几台计算机，计算机的通信和人的通信是一个道理，把教室里面的人都比作一个个计算机，假设教室里面的人都是瞎子，其实计算机就是瞎子的，计算机通信基本靠吼，现在我要找教室里面的飞哥要战狼2的片，然后我就吼一声，说我要找飞哥要战狼2的片，战狼2的片就属于我的数据，但是我在发的时候我是不是要标识我是谁，我要找谁，我是谁就是我的mac地址，我要找谁就是飞哥的mac地址，这两个地址做数据包的头部，再加上数据战狼2的片就构成了一个数据帧。

这个数据包封装好以后就往外发，到物理层以后就全部转成二级制，往外发是怎么发的呢？就是靠吼。即“我是Edison，我找飞哥要战狼2的片”。这么吼了一嗓子以后，全屋子的人都能听到，这就是广播。

计算机底层，只要在一个教室里（一个局域网），都是靠广播的方式，吼。

局域网的理解：什么是互联网，互联网就是由一个个局域网组成，局域网内的计算机不管是对内还是对外都是靠吼，这就是数据链路层的工作方式-----广播。

![image](https://upload-images.jianshu.io/upload_images/6943526-4c95cbd994059d4f?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240) 

广播出去以后，所有人都听得见，所有人都会拆开这个包，读发送者是谁，接收者是谁，**只要接收者不是自己就丢弃掉**。对计算机来说，它会看自己的Mac地址，飞哥收到以后，他就会把片发给我，发送回来同样采用广播的方式了，靠吼。

同一个教室（同一个局域网）的计算机靠吼来通信，那不同教室的计算机又如何？

比如说局域网1的pc1与局域网2的pc10如何通信？**你在教室1（局域网1）吼，教室2（局域网2）的人肯定是听不见的。这就是跨网络进行通信，数据链路层就解决不了这个问题了，这就得靠网络层出面了。**

![image](https://upload-images.jianshu.io/upload_images/6943526-e2b79020840cbb48?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240) 

在讲网络层之前，其实基于广播的这种通信就可以实现全世界通信了，你吼一声，如果全世界是一个局域网，全世界的计算机肯定可以听得见，从理论上似乎行得通，如果全世界的计算机都在吼，你想一想，这是不是一个灾难。因此，全世界不能是一个局域网。于是就有了网络层。

**网络层（network layer）：**

网络层定义了一个IP协议，

你想，我是这个教室的一个学生，我想找隔壁教室一个叫老王的学生，我也不认识老王，那怎么办，我吼？老王在另外一个教室肯定是听不到的。找教室的负责人，这个教室的负责人就负责和隔壁教室的负责人说话，说我们教室的有个学生要找你们教室的老王。往外传的东西交给负责人就可以了，内部的话上面已经提到，通过广播的方式，对外的东西广播失效。**教室的负责人就是网关，网关即网络关口的意思。**

![image](https://upload-images.jianshu.io/upload_images/6943526-065f20f023e9f4c2?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240) 

**Mac地址**是用来标识你这个教室的某个位置，**IP地址**是用来标识你在哪个教室（哪个局域网）。你要跨网络发包你是不是要知道对方的IP地址，比如你要访问百度，你肯定得知道百度服务器的IP地址。计算机在发包前，会判断你在哪个教室，对方在哪个教室，如果在一个教室，基于mac地址的广播发包就OK了；如果不在一个教室，即跨网络发包，那么就会把你的包交给教室负责人（网关）来转发。Mac地址及IP地址唯一标识了你在互联网中的位置。

数据链路层中会把网络层的数据包封装到数数据链路层的数据位置，然后再添加上自己的包头，再发给物理层，物理层发给网关，网关再发给对方教室的网关，对方教室的网关收到后在那个教室做广播。

在数据链路层看，数据封装了两层，跟玩俄罗斯套娃有点类似，一层套了一层。

![image](https://upload-images.jianshu.io/upload_images/6943526-ada21e19c6604771?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240) 

最终变成

![image](https://upload-images.jianshu.io/upload_images/6943526-c2c424787fda3889?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240) 

现在来看另一个问题，在吼之前怎么知道对方的Mac地址？这就得靠ARP协议。

ARP协议的由来：在你找飞哥要片之前，你的先干一件事，想办法知道飞哥的Mac地址。即你的机器必须先发一个ARP包出去，ARP也是靠广播的方式发，ARP发送广播包的方式如下：

![image](https://upload-images.jianshu.io/upload_images/6943526-ee88bf361116cb8d?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240) 

局域网中怎么获取对方的Mac地址：

肯定要知道对方的IP地址，这是最基本的，就像你要访问百度，肯定得知道百度的域名，域名就是百度的IP地址。自己的IP可以轻松获得，自己的Mac也轻松获取，目标Mac为12个F，我们叫广播地址，表达的意思是我想要获取这个目标IP地址172.16.10.11的机器的Mac地址。Mac为12个F代表的是一种功能，这个功能就是获取对方的MAC地址，计算机的Mac永远不可能是12个F。假设是在本教室广播，一嗓子吼出去了，所有人开始解包，只有IP地址是172.16.10.11的这个人才会返回他的Mac地址，其他人全部丢弃。发回来源Mac改成飞哥自己的Mac地址，同时把飞哥的Mac地址放在数据部分。

跨网络怎么获取对方的Mac地址：

通过IP地址区分，计算机运算判断出飞哥不在同一个教室，目标IP就变成了网关的IP了。网关的IP在计算机上配死了，可以轻松获取。

![image](https://upload-images.jianshu.io/upload_images/6943526-20f3271b13201f89?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240) 

![image](https://upload-images.jianshu.io/upload_images/6943526-0b9cf75d57193fd9?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240) 

这样网关就会把它的Mac地址返回给你，然后正常发包

![image](https://upload-images.jianshu.io/upload_images/6943526-132fe9286290e8a0?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240) 

网关帮你去找飞哥，但对用户来说，我们根本就感觉不到网关的存在。

**传输层（transport layer）**

上面的三层协议让不同的计算机之间可以通信。但计算机中实际上有许多个进程，每个进程都可能有通信的需求。这就好像一所房子里住了好几个人（进程），如何让信精确的送到某个人手里呢？遵照之前相同的逻辑，我们需要在信纸上写上新的信息，比如收信人的姓名，才可能让信送到。所以，传输层就是在信纸的空白上写上新的“收信人”信息。每一所房子会配备一个管理员(传输层协议)。管理员从邮差手中接过信，会根据“收信人”，将信送给房子中的某个人。

传输层的由来：网络层的ip帮我们区分子网，以太网层的mac帮我们找到主机，然后大家使用的都是应用程序，你的电脑上可能同时开启qq，暴风影音，等多个应用程序，

那么我们通过ip和mac找到了一台特定的主机，如何标识这台主机上的应用程序，答案就是端口，端口即应用程序与网卡关联的编号。

传输层功能：建立端口到端口的通信

补充：端口范围0-65535，0-1023为系统占用端口

传输层协议，比如TCP和UDP，使用端口号(port number)来识别收信人(某个进程)。在写信的时候，我们写上目的地的端口。当信到达目的地的管理员手中，他会根据传输层协议，识别端口号，将信送给不同的人。

TCP和UDP协议是两种不同的传输层协议。UDP协议类似于我们的信件交流过程。TCP协议则好像两个情人间的频繁通信。一个小情人要表达的感情太多，以致于连续写了好几封信。而另一方必须将这些信按顺序排列起来，才能看明白全部的意思。TCP协议还有控制网络交通等功能。

tcp协议：

可靠传输，TCP数据包没有长度限制，理论上可以无限长，但是为了保证网络的效率，通常TCP数据包的长度不会超过IP数据包的长度，以确保单个TCP数据包不必再分割。

| 以太网头 | ip 头 | tcp头 | 数据 |

udp协议：

不可靠传输，”报头”部分一共只有8个字节，总长度不超过65,535字节，正好放进一个IP数据包。

| 以太网头 | ip头 | udp头 | 数据 |

**应用层（application layer）**

通过上面的几层协议，我们已经可以在任意两个人(进程)之间进行通信。然而每个人实际上从事的是不同的行业。有的人是律师，有的人外交官。比如说律师之间的通信，会用严格的律师术语，以免产生纠纷。再比如外交官之间的通信，必须符合一定的外交格式，以免发生外交误会。再比如间谍通过暗号来传递加密信息。应用层协议是对信件内容进一步的用语规范。应用层的协议包括用于Web浏览的HTTP协议，用于传输文件的FTP协议，用于Email的IMAP等等。

应用层由来：用户使用的都是应用程序，均工作于应用层，互联网是开发的，大家都可以开发自己的应用程序，数据多种多样，必须规定好数据的组织形式 。

应用层功能：规定应用程序的数据格式。

例：TCP协议可以为各种各样的程序传递数据，比如Email、WWW、FTP等等。那么，必须有不同协议规定电子邮件、网页、FTP数据的格式，这些应用程序协议就构成了”应用层”。

![image](https://upload-images.jianshu.io/upload_images/6943526-7fb6f4f1bf2ef93f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240) 

#### 总结

网络协议保证了可读信息在整个转换和传输过程中的完整性。
