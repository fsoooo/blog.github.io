在MySQL中有很多特殊符号，比如字符串中有单引号（'）、双引号（"）、反斜杠（\）等等，有时候不注意就会踩坑。在我们平时操作SQL中，一不注意这些符号就会给你背上一口锅。今天来看看反斜杠（\）都有哪些坑。

![](https://upload-images.jianshu.io/upload_images/6943526-2dd089da7eb25b39.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)


## INSERT语句中有反斜杠（\）

#### 实际测试

用下面这些SQL来测试一下反斜杠（\）在INSERT语句

```
INSERT INTO `demo0526` (`id`, `text`) VALUES (null, 'D:\陈哈哈\加班');
INSERT INTO `demo0526` (`id`, `text`) VALUES (null, 'D:\\陈哈哈\\加班');
INSERT INTO `demo0526` (`id`, `text`) VALUES (null, 'D:\\\陈哈哈\\\加班');
INSERT INTO `demo0526` (`id`, `text`) VALUES (null, 'D:\\\\陈哈哈\\\\加班');
INSERT INTO `demo0526` (`id`, `text`) VALUES (null, 'D:\\\\\陈哈哈\\\\\加班');
```

插入后的结果：

```
mysql> select * from demo0526;
+----+-----------------------+
| id | text                  |
+----+-----------------------+
|  1 | D:陈哈哈加班          |
|  2 | D:\陈哈哈\加班        |
|  3 | D:\陈哈哈\加班        |
|  4 | D:\\陈哈哈\\加班      |
|  5 | D:\\陈哈哈\\加班      |
+----+-----------------------+
5 rows in set (0.00 sec)
```

**我们发现结果如下：**
```
当字符串中有1个反斜杠，插入后算0个。

当字符串中有2个反斜杠，插入后算1个。

当字符串中有3个反斜杠，插入后算1个。

当字符串中有4个反斜杠，插入后算2个。

当字符串中有5个反斜杠，插入后算2个。
```
#### 分析

后来发现，原因其实很简单，在MySQL中，反斜杠在字符串中是属于转义字符，经过语法解析器解析时会进行一次转义，所以当我们insert反斜杠（\）字符时，如 insert “\” 在数据库中最终只会存储""，第一个反斜杠（\）被当做**`转义字符`**处理。

同理，像这种 D:\\陈哈哈\\加班 字符串，语法解析器解析到第三个反斜杠（\）时，又会把它当做下一个转义字符进行处理，因此D:\\陈哈哈\\加班入库后变成了D:\陈哈哈\加班。

所以我们在代码中处理插入语句碰到反斜杠时，注意\是否已经改成\，否则入库后字符串会不一致。

##SELECT查询反斜杠（\）

#### 实际测试

用like模糊匹配来测试一下

```
mysql> select * from demo0526;
+----+-----------------------+
| id | text                  |
+----+-----------------------+
|  1 | D:陈哈哈加班          |
|  2 | D:\陈哈哈\加班        |
|  3 | D:\陈哈哈\加班        |
|  4 | D:\\陈哈哈\\加班      |
|  5 | D:\\陈哈哈\\加班      |
+----+-----------------------+
```
用单个反斜杠和两个反斜杠来查询
```
mysql> SELECT * from demo0526 where text like '%\%';
Empty set (0.00 sec)

mysql> SELECT * from demo0526 where text like '%\\%';
Empty set (0.00 sec)
```

这里我们会发现用like '%%'、like '%\%'查询后发现都查不到数据

别着急，我会告诉你SELECT语句中四个反斜杠（\\）代表一个么？呀，我赶快换成like '%\\%'试一试。

```
mysql> SELECT * from demo0526 where text like '%\\\\%';
+----+-----------------------+
| id | text                  |
+----+-----------------------+
|  2 | D:\陈哈哈\加班        |
|  3 | D:\陈哈哈\加班        |
|  4 | D:\\陈哈哈\\加班      |
|  5 | D:\\陈哈哈\\加班      |
+----+-----------------------+
4 rows in set (0.00 sec)
```

那我如果查询表中带有两个反斜杠（\）的数据，岂不是要like八个。。。。

别拦我，我看看tm是谁设计的这规则。
```
mysql> SELECT * from demo0526 where text like '%\\\\\\\\%';
+----+-----------------------+
| id | text                  |
+----+-----------------------+
|  4 | D:\\陈哈哈\\加班      |
|  5 | D:\\陈哈哈\\加班      |
+----+-----------------------+
2 rows in set (0.00 sec)
```

#### 分析

原来在mysql的like语法中，like后边的字符串除了会在语法解析时转义一次外，还会在正则匹配时进行第二次的转义。

因此如果期望最终匹配到""，就要反转义两次，也就是由"\\"到"\"再到""。

如果是普通的精确查询（=），则无需第二次的正则转义，和INSERT语句一样。

```
mysql> SELECT * from demo0526 where text = '\\\\';
+----+------+
| id | text |
+----+------+
|  7 | \\   |
+----+------+
1 row in set (0.00 sec)
```

## 小结

在日常工作中，也会经常碰到这种符号引发的问题，尤其是用户在界面填写的数据，建议要做相关限定，做好相关的校验，明确哪些符号不允许，这样可以避免踩坑。

![](https://upload-images.jianshu.io/upload_images/6943526-e84b8f853f00071f.gif?imageMogr2/auto-orient/strip)

