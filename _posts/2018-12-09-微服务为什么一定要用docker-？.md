## 微服务为什么一定要用docker ？

### 物理机、虚拟机、容器

所谓的**物理机**就是下面这样的别墅

![img](https://mmbiz.qpic.cn/mmbiz_jpg/SYoYmIOcI5qicOcLAxn1g0nc05gb1IibicmLSCVFjIzEr83DfwOBMOH5atEHFo4nEJ5kjsXQNiaetPaBERPeWP0ZZA/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)



那么**虚拟机**就是下面这样的套房

![img](https://mmbiz.qpic.cn/mmbiz_jpg/SYoYmIOcI5qicOcLAxn1g0nc05gb1Iibicmzgt2KkQZj0yLGJAaQ80pN3KsE6eSzPygomIeGWucDKKX7KgBbH469Q/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

最后就是我们的**容器**，就是下面这样的胶囊公寓

![img](https://mmbiz.qpic.cn/mmbiz_jpg/SYoYmIOcI5qicOcLAxn1g0nc05gb1IibicmpjHNk9rnBiceq2gdXIsBlgric17J8uichibrG5VSwsibHSBvfhvzDu7vQcw/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

那么，专业的说法就是，容器是一种轻量级、可移植、自包含的软件打包技术，使应用程序可以在几乎任何地方以相同的方式运行。容器之间是共享同一套操作系统资源的，由于容器是共享主操作系统的内核，因此就无法在服务器上运行与主服务器不同的操作系统，也就是说不能再Linux的服务器上运行Windows。就如上面哪个图一样，每个胶囊容器是公用一个厕所，厨房，每个胶囊内无法再构建出自己的厕所和厨房！

### 容器的优势

#### 隔离强

**过去**:应用之间相互影响。一个应用出现问题，CPU100%了，这个服务器上的其他应用一起凉凉。一个大型应用拆分为几十个微服务，分别交由不同的团队开发，不同团队之间水平参差不齐。如果还采用这种部署方式，你的应用和某个坑爹团队的应用部署在了同一台服务器上，至于结果，我相信你懂的。

**现在**:用上了docker容器后，将Docker可以将我们的应用程序打包封装到一个容器中，该容器包含了应用程序的代码、运行环境、依赖库、配置文件等必需的资源。容器之间达到进程级别的隔离，在容器中的操作，不会影响道宿主机和其他容器，这样就不会出现应用之间相互影响的情形！

#### 可移植性

**过去:**曾几何时我们和测试MM之间聊天内容是这样的

> **开发:"你去测试环境上，按照开发环境一样，再去搭三套一样的测试环境！"**    
>
> **测试:"我….."**    
>
> **几个小时过去了…**    
>
> **测试:"你帮我看看，为什么启动报错，是不是漏配了什么参数?"**    
>
> **开发:"我…."**

于是接下来几个小时就这么愉快的和测试mm一起聊天中过去了！！嗯，我相信有些公司是为了解决开发的单身问题，才不使用docker,用心良苦!

然而，和运维GG之间聊天一般是这样的

> **运维:"开发这群脑残，发布的新war包，又把生产搞挂了！"**   
>
> **开发:"这帮运维傻叉么，我本地好好的，怎么一上生产就不行了！"**   
>
> **…**

于是接下来的几个小时，就在和运维之间的撕逼中过去了!嗯，最终苦的是用户啊！

**现在:**自从用上docker容器后，可以实现开发、测试和生产环境的统一化和标准化。镜像作为标准的交付件，可在开发、测试和生产环境上以容器来运行，最终实现三套环境上的应用以及运行所依赖内容的完全一致。
在现在微服务的架构中，一个应用拆成几十个微服务，每个微服务都对应有开发、测试、生产三套环境需要搭建。自己算算，如果采用传统的部署方式，有多少环境需要部署。曾听闻某公司在新建一个项目的时候，要花整整一个礼拜来搭建环境，简直是惨不忍睹!

**什么，你和我说，你们用上了docker，却还存在这些问题？**
笔者曾见过某些公司是这么用docker的。确实虚拟化出容器了，然后在容器上建立ssh server。接下来就厉害了，部署方式完全没变，直接连上容器，一切部署照旧！对此，我也是一言难尽啊！你们这是给领导搭的docker么？

#### 轻量和高效

**过去:**一个应用部署在一个虚拟机上，虚拟机非常重，构建速度慢，且占用资源多，一台物理机上只能起十来个虚拟机！

**现在:**
和虚拟机相比，容器仅需要封装应用和应用需要的依赖文件，实现轻量的应用运行环境，且拥有比虚拟机更高的硬件资源利用率。在微服务架构中，有些服务负载压力大，需要以集群部署，可能要部署几十台机器上，对于某些中小型公司来说，使用虚拟机，代价太大。如果用容器，同样的物理机则能支持上千个容器，对中小型公司来说，省钱！
比如，你说容器启动速度快？难道你工作中吃饱了撑着没事干，一直重启虚拟机么？


你说虚拟机消耗资源多？绝大部分公司的服务器资源利用率应该都不到 50%，大量的CPU、内存、本地磁盘都是常年浪费的，所以 VM 的额外开销不过是浪费了原本就在浪费的资源罢了。所以笔者认为，对于传统应用来说，使用和不使用Docker可能并不能直接给企业带来好处，相反使用中遇到了问题肯定会给企业带来麻烦，对于传统企业来说，不要盲目跟风，VM虚拟机其实够用了！

## 总结

在技术演进中，docker只是趋势，并不是结果。相信在未来，一定有更高大上的部署架构出现!
