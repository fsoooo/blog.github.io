### **正向代理**

　　正向代理类似一个跳板机，代理访问外部资源。
![image](http://upload-images.jianshu.io/upload_images/6943526-05453821f7481f34.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

举个例子：

　　我是一个用户，我访问不了某网站，但是我能访问一个代理服务器，这个代理服务器呢,他能访问那个我不能访问的网站，于是我先连上代理服务器,告诉他我需要那个无法访问网站的内容，代理服务器去取回来,然后返回给我。从网站的角度，只在代理服务器来取内容的时候有一次记录，有时候并不知道是用户的请求，也隐藏了用户的资料，这取决于代理告不告诉网站。

　　**客户端必须设置正向代理服务器，当然前提是要知道正向代理服务器的IP地址，还有代理程序的端口。**

　　例如之前使用过这类软件例如CCproxy，http://www.ccproxy.com 需要在浏览器中配置代理的地址。

![image](http://upload-images.jianshu.io/upload_images/6943526-c27864b619c54c8f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)


总结来说：正向代理 是一个位于客户端和原始服务器(origin server)之间的服务器，为了从原始服务器取得内容，客户端向代理发送一个请求并指定目标(原始服务器)，然后代理向原始服务器转交请求并将获得的内容返回给客户端。客户端必须要进行一些特别的设置才能使用正向代理。
　　**正向代理的用途：**
（1）访问原来无法访问的资源，如google
（2） 可以做缓存，加速访问资源
（3）对客户端访问授权，上网进行认证
（4）代理可以记录用户访问记录（上网行为管理），对外隐藏用户信息

例如CCProxy用途：

![image](http://upload-images.jianshu.io/upload_images/6943526-07a5f3f937633a14.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)


### **反向代理**

　　初次接触方向代理的感觉是，客户端是无感知代理的存在的，反向代理对外都是透明的，访问者者并不知道自己访问的是一个代理。因为客户端不需要任何配置就可以访问。

　　反向代理（Reverse Proxy）实际运行方式是指以代理服务器来接受internet上的连接请求，然后将请求转发给内部网络上的服务器，并将从服务器上得到的结果返回给internet上请求连接的客户端，此时代理服务器对外就表现为一个服务器。

反向代理的作用：

（1）保证内网的安全，可以使用反向代理提供WAF功能，阻止web攻击

大型网站，通常将反向代理作为公网访问地址，Web服务器是内网。

![image](http://upload-images.jianshu.io/upload_images/6943526-39e38a06db3026b0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

（2）负载均衡，通过反向代理服务器来优化网站的负载

![image](http://upload-images.jianshu.io/upload_images/6943526-c2b6797d86da8801.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

## 正向代理和反向代理的区别

- 位置不同 
  正向代理，架设在客户机和目标主机之间； 
  反向代理，架设在服务器端；

- 代理对象不同 
  正向代理，代理客户端，服务端不知道实际发起请求的客户端； 
  反向代理，代理服务端，客户端不知道实际提供服务的服务端； 

![image.png](https://upload-images.jianshu.io/upload_images/6943526-75991f93d63a980b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

  

  备注：正向代理–HTTP代理为多个人提供翻墙服务；反向代理–百度外卖为多个商户提供平台给某个用户提供外卖服务。

- 用途不同 
  正向代理，为在防火墙内的局域网客户端提供访问Internet的途径； 
  反向代理，将防火墙后面的服务器提供给Internet访问；

- 安全性不同 
  正向代理允许客户端通过它访问任意网站并且隐藏客户端自身，因此必须采取安全措施以确保仅为授权的客户端提供服务； 
  反向代理都对外都是透明的，访问者并不知道自己访问的是哪一个代理。

  区别图示：
![代理.png](https://upload-images.jianshu.io/upload_images/6943526-093049f599e708b6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)




  示例：

  ##### 正向代理

  A同学在大众创业、万众创新的大时代背景下开启他的创业之路，目前他遇到的最大的一个问题就是启动资金，于是他决定去找马云爸爸借钱，可想而知，最后碰一鼻子灰回来了，情急之下，他想到一个办法，找关系开后门，经过一番消息打探，原来A同学的大学老师王老师是马云的同学，于是A同学找到王老师，托王老师帮忙去马云那借500万过来，当然最后事成了。不过马云并不知道这钱是A同学借的，马云是借给王老师的，最后由王老师转交给A同学。这里的王老师在这个过程中扮演了一个非常关键的角色，就是**代理**，也可以说是正向代理，王老师代替A同学办这件事，这个过程中，真正借钱的人是谁，马云是不知道的，这点非常关键。

  我们常说的代理也就是只正向代理，正向代理的过程，它隐藏了真实的请求客户端，服务端不知道真实的客户端是谁，客户端请求的服务都被代理服务器代替来请求，知名的科学上网工具shadowsocks 扮演的就是典型的正向代理角色。在天朝用浏览器访问 www.google.com 时，被残忍的拒绝了，于是你可以在国外搭建一台代理服务器，让代理帮我去请求google.com，代理把请求返回的相应结构再返回给我。

  ![img](http://upload-images.jianshu.io/upload_images/6943526-346d9dccec6ea598?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

  ##### 反向代理

  大家都有过这样的经历，拨打10086客服电话，可能一个地区的10086客服有几个或者几十个，你永远都不需要关心在电话那头的是哪一个，叫什么，男的，还是女的，漂亮的还是帅气的，你都不关心，你关心的是你的问题能不能得到专业的解答，你只需要拨通了10086的总机号码，电话那头总会有人会回答你，只是有时慢有时快而已。那么这里的10086总机号码就是我们说的**反向代理**。客户不知道真正提供服务人的是谁。

  反向代理隐藏了真实的服务端，当我们请求 www.baidu.com 的时候，就像拨打10086一样，背后可能有成千上万台服务器为我们服务，但具体是哪一台，你不知道，也不需要知道，你只需要知道反向代理服务器是谁就好了，www.baidu.com 就是我们的反向代理服务器，反向代理服务器会帮我们把请求转发到真实的服务器那里去。Nginx就是性能非常好的反向代理服务器，用来做负载均衡。

  ![img](http://upload-images.jianshu.io/upload_images/6943526-1971c13edb4a124d?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)


## 正向代理的应用

```
1. 访问原来无法访问的资源 
2. 用作缓存，加速访问速度 
3. 对客户端访问授权，上网进行认证 
4. 代理可以记录用户访问记录（上网行为管理），对外隐藏用户信息
```

## 反向代理的应用

```
1. 保护内网安全 
2. 负载均衡 
3. 缓存，减少服务器的压力 
Nginx作为最近较火的反向代理服务器，安装在目的主机端，主要用于转发客户机请求，后台有多个http服务器提供服务，nginx的功能就是把请求转发给后台的服务器，决定哪台目标主机来处理当前请求。
```

### **nginx的反向代理**

 　　nginx支持配置反向代理，通过反向代理实现网站的负载均衡。这部分先写一个nginx的配置，后续需要深入研究nginx的代理模块和负载均衡模块。

nginx通过proxy_pass_http 配置代理站点，upstream实现负载均衡。
![image](http://upload-images.jianshu.io/upload_images/6943526-f9d7e04fa9dcf621.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)




# 总结

两者的区别在于代理的对象不一样：**正向代理**代理的对象是客户端，**反向代理**代理的对象是服务端

正向代理是从客户端的角度出发，服务于特定用户（比如说一个局域网内的客户）以访问非特定的服务；

反向代理正好与此相反，从服务端的角度出发，服务于非特定用户（通常是所有用户），已访问特定的服务。
